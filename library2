enum BookStatus { AVAILABLE, RESERVED, LOANED, LOST }
enum UserRole { LIBRARIAN, MEMBER }
enum ReservedStatus { PENDING, SUCCESS, CANCELLED, TRANSFERRED }

//Các trường của sách
class Book
private:
  int m_book_id // Primary Key
  string m_ISBN
  string m_title
  string m_author
  string m_publisher
  date m_year
  string m_genre
  string m_language
  
//Các trường của 1 bản vật lý của sách
class BookCopy
private:
  int m_book_id // Foreign key to BOOK
  string m_barcode
  string m_shelf_location
  BookStatus m_book_status 

// Các trường của 1 người dùng
class LibraryUser
private:
  UserRole m_user_role
  int m_user_id // Primary Key
  string m_full_name
  string m_email
  string m_password_hash
  date m_created_at

// Các trường của 1 thẻ đặt trước
class ReservationCard
private:
  int m_reservation_id // Primary Key
  int m_user_id
  string m_barcode
  date m_reservation_date
  date m_pickup_deadline
  ReservedStatus m_status

// Các trường của 1 thẻ mượn
class BorrowingCard
private:
  int m_card_id // Primary Key
  int m_user_id
  string m_barcode
  date m_borrow_date
  date m_due_date
  date m_return_date
  int m_extensions_used
  int m_fine_amount

public:
  // Kiểm tra quá hạn 
  boolean isOverdue(date current_date) {}

  // Kiểm tra có thể gia hạn được không 
  boolean canExtend(int max_extensions) {}

  //Tính tiền phạt, quá hạn x ngày thì fine_per_day nhân x ngày
  int calculateFine(date current_date, int fine_per_day) {}

class BookManager
private:
  list<Book> books
  list<BookCopy> book_copies

public:
  //ADD BOOKS
  void addBook(string isbn, string title, string author, string publisher, date year, string genre, string language) {}

  //Add copy of books
  void addBookCopy(int book_id, string barcode, string shelf_location) {} 

  //EDIT BOOKS
  boolean editBook(int book_id, string new_title, string new_author, string new_publisher, date new_year, string new_genre, string new_language) {}

  //DELETE BOOKS  
  boolean deleteBook(int book_id) {}

  //SEARCH
  //Chuyển về chữ thường
  string toLowerCase(string str) {}

  //Tìm theo từ khóa
  list<Book> searchByKeyword(string keyword) {}
  list<Book> searchByAuthor(string author) {}
  list<Book> searchByTitle(string title) {}
  list<Book> searchByGenre(string genre) {}
  list<Book> searchByPublisher(string publisher) {}

  //Sắp xếp
  list<Book> sortBooksByTitleAscending() {}
  list<Book> sortBooksByTitleDescending() {}
  list<Book> sortBooksByYearAscending() {}
  list<Book> sortBooksByYearDescending() {}

class UserManager 
private:
  list<LibraryUser> users

public:
  // Đăng ký
  void registerUser(UserRole role, string full_name, string email, string password) {}

  // Gửi mã xác thực
  void sendOTP(string email) {}

  //Login Users
  boolean loginUser(string email, string password) {}
  
  //Change Password
  boolean changePassword(int user_id, string old_password, string new_password) {}

  //Check Librarian Role
  boolean isLibrarian(int user_id) {}

  //EDIT Users
  boolean editUser(UserRole role, int user_id, string full_name, string email, string password) {}

  //DELETE Users
  boolean deleteUser(int user_id) {}

class BorrowingManager
private:
  list<BorrowingCard> borrowing_cards
public:
  // Tạo mới thẻ mượn sách
  boolean borrowBook(int user_id, string barcode, date borrow_date, date due_date) {}

  //Kiểm tra giới hạn số lần mượn
  boolean checkBorrowLimit(int user_id, int max_borrows) {}

  // Cập nhật trả sách 
  boolean returnBook(int card_id, string barcode, date return_date) {}

  // Gia hạn ngày trả sách
  boolean extendDueDate(int card_id, date new_due_date, int max_extensions) {}

  //Lịch sử mượn sách của người dùng
  list<BorrowingCard> getUserBorrowingHistory(int user_id) {}
  list<ReserveCard> getUserReserveHistory(int user_id) {}

class ReservationManager
private:
  list<ReservationCard> reservation_cards
public:
  // Tạo mới thẻ đặt trước
  boolean reserveBook(int user_id, string barcode, date reservation_date, date pickup_deadline) {}

  // Hủy đặt trước
  boolean cancelReservation(int reservation_id) {}

  // Hủy đặt trước nếu quá hạn đến ngày lấy sách
  boolean autoCancelExpiredReservations(int reservation_id, date current_date) {}

  // Nhận sách đã đặt trước
  boolean pickupBook(int reservation_id) {}

  // Chuyển từ đặt trước sang mượn sách
  boolean transferReservationToBorrow(int reservation_id, date borrow_date, date due_date) {}
  
  // Giới hạn đặt trước cho mỗi cuốn sách chỉ 1 người dùng được đặt trước
  boolean checkReservationLimit(int user_id, string barcode) {}
